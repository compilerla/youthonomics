<div class="content-wrap">
  <div class="container-fluid" id="home-hero" data-parallax="scroll" data-image-src="{{cms:file:homepage_hero.jpg}}" data-speed="0.7">
    <section class="row">
      <div class="col">
        <header>
          <h1 class="white">The Future of Any Country is its Youth. It's Time We Put Youth at the Top of the Global Agenda.</h1>
          <h4 class="emphasis-copy white">Support a global 2-year work visa system for youth.</h4>
        </header>
        {{ cms:snippet:hero_mc_form }}

        <!-- <form class="support-now" action="" method="post">
          <div class="centerer">
            <div class="input-text-container">
              <input type="text" placeholder="First and Last Name" name="name" value="">
            </div>
            <div class="input-text-container">
              <input type="text" placeholder="Email Address" name="email" value="">
            </div>
          </div>
          <div class="input-submit-container">
            <input class="btn fill-red" type="submit" name="support" value="support">
          </div>
        </form> -->
      </div>
    </section>
  </div><!-- /.container-fluid#home-hero -->

  <div class="container-fluid" id="report-section">
    <section class="row">
      <header>
        <h1>The Youthonomics Index - How does your country rank?</h1>
        <h4 class="emphasis-copy">The Youthonomics team has spent more than a year compiling data on 64 countries based on a wide range of indicators to assess how youth-friendly each country is. A nation's ranking is deterined according to current conditions and whether the country is investing in its youth's future. Our goal is to give people the information they need to make better decisions -  whether they should stay where they are or seek a more hopeful future elsewhere.</h4>
      </header>
      <div class="col-md-4 col-md-offset-4" id="country-scroll">
        <ul class="country-list">
        </ul>
        <a href="/" class="btn fill-red">view pdf online</a>
        <a href="/" class="btn outline-red">download report</a>
      </div>
    </section>
  </div><!-- /.container-fluid#report-section -->

  <div class="container-fluid" id="homepage-map">
    <section class="row">
      <div id="map"></div>
    </section>
    <section class="row" id="legend">
      <h5 class="small">Ranking Legend</h5>
      <div class="col-xs-4 col-sm-offset-3 col-sm-2">
        <div class="circle" id="high-ranking">
          <h6>High Rankings</h6>
        </div>
      </div><!-- /#high-ranking -->
      <div class="col-xs-4 col-sm-2">
        <div class="circle" id="avg-ranking">
          <h6>Average Rankings</h6>
        </div>
      </div><!-- /#avg-ranking -->
      <div class="col-xs-4 col-sm-2">
        <div class="circle" id="low-ranking">
          <h6>Low Rankings</h6>
        </div>
      </div><!-- /#low-ranking -->
    </section>
  </div><!-- /.container-fluid#homepage-map -->

  <div class="container-fluid" id="contribute">

    <section class="row" id="visa-heading">
      <header>
        <h1 class="white">Why A Global Youth Work Visa?</h1>
        <h4 class="emphasis-copy white">
          No country in the world can afford to see its youth leave. Young people are the lifeblood of a country's economy and innovative potential; the key to its competitiveness and future economic well-being. Creating a Global Youth Work Visa will allow youth to seek out opportunities elsewhere if their country is not giving them what they need.
        </h4>
        <h4 class="emphasis-copy white">
          The visa will allow youth to experience firsthand how certain countries lift youth up, while others knock them down.
          Youth will be able to learn best practices from the countries that support them and bring these ideas home to fight for a better future.
        </h4>
      </header>
    </section>

    <section class="row" id="help-sections">
      <div class="col-sm-3 panel action-panel">
        <div class="overlay">
          <h5>Share Youthonomics</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Share Youthonomics </h5>
          <p>
            Excited about seeing your country rank well? Disappointed that it's not doing more for you?  Share Youthonomics and help us build a global movement.
          </p>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-lig1-red">
        <div class="overlay">
          <h5>Demand economic mobility!</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Demand economic mobility!</h5>
          <p>
            Young people deserve a way to vote with their feet - support a new global work visa for youth.
          </p>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-med2-red">
        <div class="overlay">
          <h5>Support Youthonomics</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Support Youthonomics</h5>
          <p>
            We can't continue our work without your support.
          </p>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-dark-red">
        <div class="overlay">
          <h5>Build our global network</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Build our global network</h5>
          <p>
            We're looking for leaders in every country.  Sign on and help us build the movement with your local community.
          </p>
        </div>
      </div><!-- /.action-panel -->
    </section>
  </div><!-- /.container-fluid#contribute -->
</div><!-- /.content-wrap -->

<script>
  var countriesData = {{ cms:helper:country_data }};

  function listCountries(data) {
    for (obj in data) {
      var country = data[obj];
      $('.country-list').append("<li>" + country.country + "</li>");
    }
  }

  function chooseColor(score){
    var sorted = _.sortBy(countriesData, function(country){
      return country.score;
    });

    var breakPoint1 = sorted[Math.floor(sorted.length / 3)].score;
    var breakPoint2 = sorted[Math.floor(sorted.length / 3 * 2)].score;
    
    if(score >= breakPoint2){
      return '#FF1C2D';
    } else if(score >= breakPoint1){
      return '#FF7781';
    } else {
      return '#524445';
    }
  }

  function averageScore(countries){
    var total = 0;
    for(var i = 0; i < countries.length; i++){
      total += countries[i].score;
    }
    return total / countries.length;
  }

  $(document).ready(function(){

    listCountries(countriesData);

    L.mapbox.accessToken = 'pk.eyJ1Ijoibm9ucGhvdG9ibHVlIiwiYSI6ImI0YTA5ZDIwZmRiOWNhNmE0MTI4MjMxMWY2ZThiNTJkIn0.RThxoY1h4-FxgIFASF2bBA';
    var map = L.mapbox.map('map', 'nonphotoblue.245216c2')
      .setView([41, -20], 3);

    map.scrollWheelZoom.disable();

    var average = averageScore(countriesData);
    var featureData = countriesData.map(function(countryData){
      return {
        type: 'Feature',
        properties: _.extend({
          'marker-color': chooseColor(countryData.score)
        }, countryData),
        geometry: {
          type: 'Point',
          coordinates: [countryData.lng, countryData.lat]
        }
      }
    });

    var featureLayer = L.mapbox.featureLayer({
      type: 'FeatureCollection',
      features: featureData,

    })
    .addTo(map);

    featureLayer.eachLayer(function(layer) {
      var content = HandlebarsTemplates['country-popup'](layer.feature.properties);
      layer.bindPopup(content);
    });
  });
</script>

{{ cms:snippet:footer }}
