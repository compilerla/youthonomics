<div class="content-wrap">
  <div class="container-fluid" id="home-hero" data-parallax="scroll" data-image-src="{{cms:file:homepage_hero_00_main.jpg}}" data-speed="0.7">
    <section class="row">
      <div class="col">
        <header>
          <h1 class="white">The future of any country is its youth. Isnâ€™t it about time we put youth at the top of the global agenda?</h1>
          <p class="emphasis-copy white">Help Youthonomics demand a 2-year Global Youth Visa Give youth everywhere the mobility they need to thrive</p>
        </header>
        {{ cms:snippet:hero_mc_form }}

        <!-- <form class="support-now" action="" method="post">
          <div class="centerer">
            <div class="input-text-container">
              <input type="text" placeholder="First and Last Name" name="name" value="">
            </div>
            <div class="input-text-container">
              <input type="text" placeholder="Email Address" name="email" value="">
            </div>
          </div>
          <div class="input-submit-container">
            <input class="btn fill-red" type="submit" name="support" value="support">
          </div>
        </form> -->
      </div>
    </section>
  </div><!-- /.container-fluid#home-hero -->

  <div class="container-fluid" id="report-section">
    <section class="row">
      <header>
        <h1>The Youthonomics Index</h1>
        <div class="video-container">
          <iframe src="https://www.youtube.com/embed/yIv290E9QuY" frameborder="0" allowfullscreen></iframe>
        </div>
        <div class="copy-container">
          <h4 class="emphasis-copy">How does your country rank?</h4>
          <p class="emphasis-copy">The Youthonomics team has spent more than a year compiling data on 64 countries based on a wide range of indicators to assess how youth-friendly each country is. A nation's ranking is deterined according to current conditions and whether the country is investing in its youth's future. Our goal is to give people the information they need to make better decisions -  whether they should stay where they are or seek a more hopeful future elsewhere.</p>
        </div>
      </header>
      <div class="col-md-4 col-md-offset-4" id="country-scroll">
        <div class="btn fill-red" data-name="online">view pdf online</div>
        <div class="btn outline-red">download report</div>
      </div>
    </section>
  </div><!-- /.container-fluid#report-section -->

  <div class="container-fluid" id="homepage-map">
    <section class="row">
      <div id="map"></div>
    </section>
    <section class="row padded" id="legend">
      <div class="col-xs-12 col-sm-2 col-sm-offset-2 text-right">
        <h5 class="small">Ranking Legend</h5>
      </div>
      <div class="col-xs-4 col-sm-2">
        <div class="circle" id="high-ranking">
          <h6>High Rankings</h6>
        </div>
      </div><!-- /#high-ranking -->
      <div class="col-xs-4 col-sm-2">
        <div class="circle" id="avg-ranking">
          <h6>Average Rankings</h6>
        </div>
      </div><!-- /#avg-ranking -->
      <div class="col-xs-4 col-sm-2">
        <div class="circle" id="low-ranking">
          <h6>Low Rankings</h6>
        </div>
      </div><!-- /#low-ranking -->
    </section>
  </div><!-- /.container-fluid#homepage-map -->

  <div class="container-fluid" id="contribute">

    <section class="row" id="visa-heading"  data-parallax="scroll" data-image-src="{{cms:file:visa_hero.jpg}}" data-speed="0.8">
      <header>
        <h1 class="white">Why A Global Youth Work Visa?</h1>
        <p class="emphasis-copy white">
          Youthonomics is dedicated to helping Generations Y and Z on a global scale. To bring about real change we are advocating for a Global Youth Visa so young people under the age of 25 can work in any UN member state for a period of 2 years. The visa will allow young people to experience firsthand how some countries lift youth up, while others knock them down. Youth will be able to learn best practices from the countries that support them, and bring these ideas home to fight for a better future.
        </p>
      </header>
    </section>

    <section class="row" id="help-sections">
      <div class="col-sm-3 panel action-panel fill-red">
        <div class="overlay">
          <h5>Share Youthonomics</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Share Youthonomics </h5>
          <p>
            Excited about seeing your country rank well? Disappointed that it's not doing more for you?  Share Youthonomics and help us build a global movement.
          </p>
          <ul class="social">
            <li>
              <a href="https://twitter.com/youthonomics" class="twitter" target="_blank">{{ cms:file:icon_twitter_light.png:image }}</a>
            </li>
            <li>
              <a href="https://www.facebook.com/Youthonomics-891209434297173/" class="fb" target="_blank">{{ cms:file:icon_fb_light.png:image }}</a>
            </li>
            <li>
              <a href="https://www.youtube.com/channel/UCBiCMjwQIWFz2IQV3EupCKA" class="yt" target="_blank">{{ cms:file:icon_yt_light.png:image }}</a>
            </li>
            <li>
              <a href="https://instagram.com/youthonomics/" class="insta" target="_blank">{{ cms:file:icon_istag_light.png:image }}</a>
            </li>
          </ul>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-blue">
        <a href="#home-hero" class="spanlink"></a>
        <div class="overlay">
          <h5>Demand economic mobility!</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Demand economic mobility!</h5>
          <p>
            Young people deserve a way to vote with their feet - support a new global work visa for youth.
          </p>
          <div class="check-it-cta">
            <div class="white">Sign Petition {{ cms:file:icon_arrow_r_light.png:image }}</div>
          </div>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-orange">
        <a href="/donate" class="spanlink"></a>
        <div class="overlay">
          <h5>Support Youthonomics</h5>
          <b>+</b>
        </div>
        <div class="content">
          <h5>Support Youthonomics</h5>
          <p>
            We can't continue our work without your support.
          </p>
          <div class="check-it-cta">
            <div class="white">Donate Now {{ cms:file:icon_arrow_r_light.png:image }}</div>
          </div>
        </div>
      </div><!-- /.action-panel -->

      <div class="col-sm-3 panel action-panel fill-green">
        <a href="/contact" class="spanlink"></a>
        <div class="overlay">
          <h5>Build our global network</h5>
          <b>+</b>
        </div>
        <div class="content">
          <a href="mailto:info@youthonomics.com" class="spanlink"></a>
          <h5>Build our global network</h5>
          <p>
            We're looking for leaders in every country.  Sign on and help us build the movement with your local community.
          </p>
          <div class="check-it-cta">
            <div class="white">Contact Us {{ cms:file:icon_arrow_r_light.png:image }}</div>
          </div>
        </div>
      </div><!-- /.action-panel -->
    </section>
  </div><!-- /.container-fluid#contribute -->
</div><!-- /.content-wrap -->
<div class="hidden" id="janky-report-pdf" data-url="{{ cms:file:Youth_report_151012.pdf }}"></div>
<script>
  var reportPdf = $('#janky-report-pdf').data('url');
  reportPdf.toString();
  var instagramPhotos = {{ cms:helper:instagram_photos }};
  var countriesData = {{ cms:helper:country_data }};
  var submitReport;

  function submitForm() {
    console.log('mailChimp API hookup here');
    var $form = $('#contact-page-form');
    var errorAmmount = $('#error-message').data("errors");
    // check if form has some stuff put into it.
    $($form).on('click', function(event){
      validateInputs($form);
      // if ( event ) { event.preventDefault(); }
      console.log(errors);
      if (errorAmmount === 0) {
        // ajaxingForm($form);
        console.log('ajax that shit');
      }
    });
  }

  function ajaxingForm($form) {
    $.ajax({
        type: $form.attr('method'),
        url: $form.attr('action'),
        data: $form.serialize(),
        cache       : false,
        dataType    : 'json',
        contentType: "application/json; charset=utf-8",
        error       : function(err) {
          alert("Could not connect to the registration server. Please try again later.");
          $('.page-overlay').addClass('hidden');
          $('#link-out').removeAttr('download');
          $('#link-out').removeAttr('target');
        },
        success     : function(data) {
            if (data.result != "success") {
                // Something went wrong. Give some feedback!
                var message = data.msg;
                message = message.slice(4, message.length);
                // $('#error-message').html(message);
            } else {
                // Hey, it submitted! let them know to check their email
                console.log(data);
            }
        }
    });
  }

  function validateInputs(form) {
    // validate emails and text inputs via regex in here;
    var requiredFields = $(form).find('[required]');

    $(form).validate({
      errorLabelContainer: "h6#error-message",
      wrapper: "div",
      invalidHandler: function(event, validator) {
        // 'this' refers to the form
        // var errors = validator.numberOfInvalids();
        // $('#error-message').attr("data-errors", errors);
      }
    });
    $(form).valid();
    var errors = $(form).numberOfInvalids();
    return errors;
  }

  function downloadReport() {

    $('#country-scroll .btn').on('click', function(){
      var buttonName = $(this).data('name');
      //pop the modal regardless
      $('.page-overlay').removeClass('hidden');
      if(buttonName === 'online') {
        // change modal href to open in a new tab to read online
        console.log('read online and open in new tab');
        $('#link-out').attr('target', '_blank');
        submitForm();
      } else {
        // pop the modal href to download now
        console.log('read offline and download.');
        $('#link-out').attr('download', true);
      }
    });
    $('.page-overlay .close').on('click', function() {
      $('.page-overlay').addClass('hidden');
      $('#link-out').removeAttr('download');
      $('#link-out').removeAttr('target');
    });
  }


  function listCountries(data) {
    for (obj in data) {
      var country = data[obj];
      $('.country-list').append("<li>" + country.country + "</li>");
    }
  }

  function chooseColor(youtho_index){
    var sorted = _.sortBy(countriesData, function(country){
      return country.youtho_index;
    });

    var breakPoint1 = sorted[Math.floor(sorted.length / 3)].youtho_index;
    var breakPoint2 = sorted[Math.floor(sorted.length / 3 * 2)].youtho_index;

    if(youtho_index >= breakPoint2){
      return '#FF1C2D';
    } else if(youtho_index >= breakPoint1){
      return '#FF7781';
    } else {
      return '#8DADB7';
    }
  }

  function averageyoutho_index(countries){
    var total = 0;
    for(var i = 0; i < countries.length; i++){
      total += countries[i].youtho_index;
    }
    return total / countries.length;
  }

  function latestGram(apiCall) {
    console.log(apiCall);
    var imgUrl = apiCall.data[0].images.standard_resolution.url;
    var photoLink = apiCall.data[0].link;
    $('.social-media-panel.instagram .media-wrap a.spanlink').attr('href', photoLink);
    $('.social-media-panel.instagram .media-wrap img.stagram-photo').attr('src', imgUrl);
  }

  $(document).ready(function(){

    console.log(countriesData);

    listCountries(countriesData);

    checkSelect('contact-page-form', 'country-name');

    downloadReport();

    latestGram(instagramPhotos);

    L.mapbox.accessToken = 'pk.eyJ1Ijoibm9ucGhvdG9ibHVlIiwiYSI6ImI0YTA5ZDIwZmRiOWNhNmE0MTI4MjMxMWY2ZThiNTJkIn0.RThxoY1h4-FxgIFASF2bBA';
    var map = L.mapbox.map('map', 'nonphotoblue.245216c2')
      .setView([41, -20], 3);

    map.scrollWheelZoom.disable();

    var average = averageyoutho_index(countriesData);
    var featureData = countriesData.map(function(countryData){
      return {
        type: 'Feature',
        properties: _.extend({
          'marker-color': chooseColor(countryData.youtho_index)
        }, countryData),
        geometry: {
          type: 'Point',
          coordinates: [countryData.lng, countryData.lat]
        }
      }
    });

    var featureLayer = L.mapbox.featureLayer({
      type: 'FeatureCollection',
      features: featureData,

    })
    .addTo(map);

    featureLayer.eachLayer(function(layer) {
      var content = HandlebarsTemplates['country-popup'](layer.feature.properties);
      layer.bindPopup(content);
    });
  });

</script>

<div class="container-fluid" id="youthonomics-news">
  <section class="row">
    <header>
      <h1><span class="brand-red">#Youthonomics</span> News</h1>
    </header>
    <div class="col-sm-4 panel social-media-panel facebook">
      <div class="media-wrap">
        <a class='spanlink' href="https://www.facebook.com/Youthonomics-891209434297173/" target="_blank"></a>
        <div class="content">
          <h5>Where It's Sick and Where it Sucks to be Young in 2015</h5>
          {{ cms:file:social_post_link_bg_00.jpg:image }}
        </div>
        <div class="check-it-cta">
          <div class="white"><a href="#">Youthonomics on Facebook {{ cms:file:icon_arrow_r_light.png:image }}</a></div>
        </div>
      </div>
    </div><!-- /.blog-panel -->
    <div class="col-sm-4 panel blog-panel fill-red">
      {{cms:partial:comfy/blog/posts/recent_post}}
    </div><!-- /.blog-panel -->
    <div class="col-sm-4 panel social-media-panel instagram">
      <div class="media-wrap">
        <a class="spanlink" href="https://instagram.com/youthonomics/" target="_blank">
          <img src="" alt="" class="stagram-photo"/>
          <div class="check-it-cta">
            <div class="white">@Youthonomics on Instagram {{ cms:file:icon_arrow_r_light.png:image }}</div>
          </div>
        </a>
      </div>
    </div><!-- /.featured-media-panel.instagram -->
  </section>
</div><!-- /.container-fluid#youthonomics-news -->

{{ cms:snippet:footer }}


<div class="page-overlay hidden">
  {{ cms:snippet:report_modal }}
</div>
